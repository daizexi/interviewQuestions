# 1.TCP三次握手四次挥手的过程

- 三次握手

   > TCP会在通信之前，利用TCP首部发送一个SYN包请求建立连接，服务器端收到SYN包之后，会发送SYN\ACK包给客户端，客户端收到之后，会发送ACK包给服务器端。

**三次握手比四次挥手少一次通信的原因，服务端在收到客户端SYN包之后，会发送ACK包给客户端，并发送SYN包，三次握手把服务器发送的SYN和ACK一起发送了。**

- 四次挥手
  
  > 客户端会发送FIN包给服务器端请求断开连接，服务器端会返回ACK包给客户端，但这时服务器端可能还有工作没有处理完，所以需要等待一会，再发送FIN包给客户端，客户端收到之后会发送ACK包给服务器端。

**从这个过程可以看到，TCP发送包的过程中，接收端必定会发送ACK包给发送端。**

# 2.四次挥手如果客户端没收到服务器返回的close会一直等吗（不会），为什么

> TCP具有超时重传机制，当经过重发超时之后，客户端会重发FIN数据包，如果一直没有收到，会把重发超时按照2倍、4倍的指数规律进行重置，一直到重发指定次数，客户端认为服务器端出现了问题，强制关闭连接。

# 3.TCP是怎么保证可靠连接的
> TCP利用序列号（Seq）保证可靠连接，因为可靠连接要求识别数据是否已经接收，TCP每发送一个包都会为它标记一个序列号（Seq），接收端在收到数据之后，查询TCP首部中的序列号（Seq）以及数据长度，把自己下一步要接收的包的序列号（Seq）发送给发送端。

**每个包都有一个Seq，Seq存在于TCP首部，接收端下一步要接收的包的Seq放在ACK包的TCP首部发送给发送方。**

# 4.为什么需要三次握手

> 《计算机网络》中有提到，三次握手是为了避免某一个旧TCP连接的SYN包在网络中滞留了很久到达了服务端，这时服务端会向发送端发送ACK包，如果不需要客户端回复ACK包的话，服务器端就会以为TCP连接已经建立，会一直等待客户端发送数据，但是实际上客户端不会向服务器端发送数据，这就导致了服务器端资源的浪费。
>
> 本质在RFC793有说明，是因为TCP为了保证可靠连接使用了Seq，同时TCP可以使用最初的Seq确认是否是相同的连接，但初始的Seq是发送端自己凭借时钟生成的，所以为了保证可靠通信，TCP在接收到一个初始Seq（SYN包的TCP首部包含初始Seq）就会向客户端请求确认，只有客户端返回了ACK包，才能保证可靠连接。

# 5.为什么需要四次挥手
> 因为四次挥手过程中，客户端向服务器端发送FIN报文，服务器端在收到这个FIN报文，可能还有数据没有发完，所以不能把ACK和FIN报文合并发送，所以只能先向发送方发送ACK包，表示确认收到FIN包，等到数据处理完成，再发送FIN包，等待收到ACK包之后，服务器端就认为TCP连接已经关闭，进入CLOSE状态，客户端在等待一段时间之后自动进入CLOSE状态，至此TCP连接关闭。



# 6.HTTPS过程
1.HTTPS是加了SSL协议的HTTP，HTTPS需要先和SSL协议，SSL协议再和TCP协议通信。
2.HTTPS采用对称加密和非对称加密结合的方法，因为单一的对称加密不能保证密钥传输安全性，单一非对称加密计算消耗资源过大。
3.HTTPS会在传输密钥阶段使用非对称加密，在通信阶段使用对称加密。
4.HTTPS的过程
 - 服务器人员首先向CA申请公钥，CA在验证了申请者身份之后，会为申请者分配公钥并用自己的私钥对公钥做数字签名，然后把经过数字签名的公钥放到数字证书发给服务器端。
 - 客户端向服务器端请求通信时，服务器端会把数字证书发给客户端，客户端会利用CA的公钥对数字证书中的公钥数字签名做验证，如果验证通过，说明这是真实的服务器端公钥。
 - 客户端会使用这个公钥对对称加密要使用的密钥进行加密处理，并发送给服务前端。
 - 服务器端收到后会使用自己的私钥进行解密。
 - 开始通信，使用对称加密。